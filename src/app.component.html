<div class="font-sans">
  @if (!loggedInUser()) {
    <!-- Login Screen -->
    <div class="min-h-screen flex flex-col items-center justify-center bg-slate-100 p-4">
      <h1 class="text-3xl font-bold text-slate-700 mb-2">ÂÆ∂‰∫ã</h1>
      <p class="text-slate-500 mb-8">ËØ∑‰ΩøÁî®ÊÇ®ÁöÑË¥¶Êà∑ÁôªÂΩï</p>
      
      <form [formGroup]="loginForm" (ngSubmit)="onLoginSubmit()" class="w-full max-w-sm space-y-4">
        <div>
          <label for="username" class="block text-sm font-medium text-slate-700">Áî®Êà∑Âêç</label>
          <input id="username" type="text" formControlName="username" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm" required>
        </div>
        <div>
          <label for="password" class="block text-sm font-medium text-slate-700">ÂØÜÁ†Å</label>
          <input id="password" type="password" formControlName="password" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm" required>
        </div>
        
        @if (loginError()) {
          <p class="text-sm text-red-600">{{ loginError() }}</p>
        }

        <button type="submit" [disabled]="loginForm.invalid" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-sky-600 hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:bg-slate-400 disabled:cursor-not-allowed">
          ÁôªÂΩï
        </button>
      </form>

      <div class="mt-6 text-xs text-slate-500 text-center p-3 bg-slate-200/80 rounded-lg w-full max-w-sm">
        <p class="font-bold">ÊµãËØïË¥¶Êà∑:</p>
        <p>Áî®Êà∑Âêç: me, mom, dad, alex</p>
        <p>ÂØÜÁ†Å: password123</p>
      </div>
    </div>
  } @else {
    <!-- Main App Content -->
    <!-- Scrollable Content Area -->
    <div class="max-w-2xl mx-auto p-4 sm:p-6 lg:p-8 pb-24">
      @if (activeTab() === 'home') {
        <!-- Sticky Header Wrapper -->
        <div class="sticky top-0 z-10 bg-slate-50/90 backdrop-blur-sm">
          <!-- Sticky Home Screen Tabs -->
          <nav #mainNav class="-mx-4 sm:-mx-6 lg:-mx-8 px-4 sm:px-6 lg:px-8 py-2 border-b border-slate-200">
            <div class="flex items-center justify-between">
              <div class="bg-slate-200/80 p-1 rounded-lg flex flex-wrap gap-1 text-xs font-bold">
                <button (click)="setActiveHomeTab('all')" [class]="activeHomeTab() === 'all' ? 'bg-white shadow-sm text-slate-700' : 'text-slate-500 hover:text-slate-700'" class="py-1.5 px-2 rounded-md transition-all">
                  ÂÖ®ÈÉ®
                </button>
                <button (click)="setActiveHomeTab('daily')" [class]="activeHomeTab() === 'daily' ? 'bg-white shadow-sm text-slate-700' : 'text-slate-500 hover:text-slate-700'" class="py-1.5 px-2 rounded-md transition-all">
                  ÂÆ∂Â∫≠Êó•Â∏∏
                </button>
                <button (click)="setActiveHomeTab('health')" [class]="activeHomeTab() === 'health' ? 'bg-white shadow-sm text-slate-700' : 'text-slate-500 hover:text-slate-700'" class="py-1.5 px-2 rounded-md transition-all">
                  ÂÆ∂Â∫≠ÂÅ•Â∫∑
                </button>
                <button (click)="setActiveHomeTab('knowledge')" [class]="activeHomeTab() === 'knowledge' ? 'bg-white shadow-sm text-slate-700' : 'text-slate-500 hover:text-slate-700'" class="py-1.5 px-2 rounded-md transition-all">
                  Áü•ËØÜÂàÜ‰∫´
                </button>
              </div>
               <button (click)="logout()" class="p-2 rounded-full hover:bg-slate-200 transition-colors" aria-label="ÂàáÊç¢Áî®Êà∑">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-slate-600">
                    <path fill-rule="evenodd" d="M2 3.25A1.25 1.25 0 0 1 3.25 2h6.5A1.25 1.25 0 0 1 11 3.25v.5a.75.75 0 0 1-1.5 0v-.5a.25.25 0 0 0-.25-.25h-5.5a.25.25 0 0 0-.25.25v13.5c0 .138.112.25.25.25h5.5a.25.25 0 0 0 .25-.25v-.5a.75.75 0 0 1 1.5 0v.5A1.25 1.25 0 0 1 9.75 18h-6.5A1.25 1.25 0 0 1 2 16.75V3.25Z" clip-rule="evenodd" />
                    <path fill-rule="evenodd" d="M13.44 10.78a.75.75 0 0 0 0-1.56l-3.25-1.5a.75.75 0 0 0-.94 1.28L10.44 10l-1.19 1.53a.75.75 0 0 0 .94 1.28l3.25-1.5Z" clip-rule="evenodd" />
                    <path fill-rule="evenodd" d="M16.25 10a.75.75 0 0 0-.75-.75h-5.5a.75.75 0 0 0 0 1.5h5.5a.75.75 0 0 0 .75-.75Z" clip-rule="evenodd" />
                  </svg>
                </button>
            </div>
          </nav>

          <!-- Sticky Health Notice -->
          @if (urgentHealthPosts().length > 0) {
            <div #stickyNotice class="shadow-md animate-fade-in-down -mx-4 sm:-mx-6 lg:-mx-8 border-b border-slate-200">
                @for(post of urgentHealthPosts(); track post.id) {
                    @let typeConfig = getPostTypeConfig(post);
                    <div (click)="scrollToPost(post.id)" [class]="'px-4 sm:px-6 lg:px-8 py-2 flex items-center gap-3 text-sm border-b cursor-pointer hover:bg-red-100/50 transition-colors ' + typeConfig.colorClasses" [class.border-red-300]="true">
                        <span [class]="typeConfig.iconClasses + ' text-lg'">{{ typeConfig.icon }}</span>
                        @if (post.subject) {
                            <img [ngSrc]="post.subject.avatar" [alt]="post.subject.name" width="24" height="24" class="w-6 h-6 rounded-full object-cover">
                        }
                        <p class="font-semibold truncate flex-1">
                          {{ typeConfig.title }}: 
                          <span class="font-normal">{{ post.content }}</span>
                        </p>
                        <span class="text-xs font-medium text-red-700/80">{{post.timestamp}}</span>
                    </div>
                }
            </div>
          }
        </div>

        <main class="mt-6 space-y-6">
          @if (homePosts().length > 0) {
            @for (post of homePosts(); track post.id) {
              @let typeConfig = getPostTypeConfig(post);
              @let isMyPost = post.author === loggedInUser()!.name;
              @let isUrgent = urgentHealthPostIds().has(post.id);

              <div class="flex flex-col transition-opacity" [id]="'post-' + post.id" [class.opacity-50]="post.status === 'DONE'">
                <!-- Message Row -->
                <div class="flex items-start gap-3" [class.justify-end]="isMyPost">
                  
                  <!-- Avatar (DOM order: 1st) -->
                  <div [class.order-2]="isMyPost">
                    @if ($first && urgentHealthPosts().length === 0) {
                      <img priority [ngSrc]="post.authorAvatar" [alt]="post.author + ' Â§¥ÂÉè'" width="40" height="40" class="h-10 w-10 rounded-full object-cover flex-shrink-0">
                    } @else {
                      <img [ngSrc]="post.authorAvatar" [alt]="post.author + ' Â§¥ÂÉè'" width="40" height="40" class="h-10 w-10 rounded-full object-cover flex-shrink-0">
                    }
                  </div>
            
                  <!-- Message Bubble (DOM order: 2nd) -->
                  <div class="w-full max-w-md flex flex-col" [class.order-1]="isMyPost" [class.items-end]="isMyPost" [class.items-start]="!isMyPost">
                    <div [class]="'p-4 w-full rounded-xl ' + typeConfig.bubbleClasses + (isMyPost ? ' rounded-tr-none' : ' rounded-tl-none')"
                         [class.shadow-lg]="isUrgent"
                         [class.ring-2]="isUrgent"
                         [class.ring-rose-500/50]="isUrgent"
                         [class.shadow-sm]="!isUrgent">
                      <!-- Bubble Header (Icon, Title, Priority, etc.) -->
                      <div class="flex justify-between items-start gap-4">
                        <h3 [class]="'font-bold text-base flex items-center gap-2 ' + typeConfig.headerTextClasses">
                          <span [class]="typeConfig.iconClasses">{{ typeConfig.icon }}</span>
                          <span>{{ typeConfig.title }}</span>
                        </h3>
                        <div class="flex items-center gap-2 shrink-0">
                          @if (post.dueDate) {
                            @let countdown = getCountdown(post.dueDate);
                            @if (countdown) {
                              <div [class]="'flex items-center gap-1.5 font-semibold text-sm ' + typeConfig.countdownClasses">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 animate-pulse">
                                  <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm.75-13a.75.75 0 0 0-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 0 0 0-1.5h-3.25V5Z" clip-rule="evenodd" />
                                </svg>
                                <span>{{ countdown }}</span>
                              </div>
                            }
                          }
                          @if (post.priority) {
                            <span [class]="'text-xs font-semibold px-3 py-1 rounded-full ' + typeConfig.priorityChipClasses(post.priority)">
                              {{ getPriorityConfig(post.priority).text }}
                            </span>
                          }
                        </div>
                      </div>
                      <!-- Bubble Content -->
                      <p [class]="'mt-2 leading-relaxed ' + typeConfig.bodyTextClasses">{{ post.content }}</p>

                      <!-- AI Analysis Section -->
                      <div [class]="'mt-4 pt-3 border-t ' + typeConfig.separatorBorderClasses">
                        @if (post.isLoadingAiSuggestion) {
                            <div [class]="'flex items-center justify-center gap-2 text-sm p-2 ' + typeConfig.bodyTextClasses">
                              <svg class="animate-spin h-5 w-5 text-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                              </svg>
                              <span>AI Ê≠£Âú®ÂàÜÊûê‰∏≠...</span>
                            </div>
                        } @else if (post.aiSuggestions && post.aiSuggestions.length > 0) {
                          @let activeSuggestion = post.aiSuggestions[post.activeAiSuggestionIndex ?? 0];
                          <div [class]="'prose prose-sm max-w-none ' + typeConfig.bodyTextClasses" [class.prose-invert]="isDarkCard(post.type)" [innerHTML]="activeSuggestion.content">
                          </div>
                          <!-- Controls -->
                          <div class="mt-4 flex justify-between items-center gap-4">
                              <!-- Navigation -->
                              @if (post.aiSuggestions.length > 1) {
                                <div class="flex items-center gap-3 text-sm font-semibold" [class.text-white]="isDarkCard(post.type)" [class.text-slate-600]="!isDarkCard(post.type)">
                                  <button (click)="changeSuggestion(post, 'prev')" [class]="'p-1 rounded-full transition-colors ' + typeConfig.reactionButtonClasses" aria-label="‰∏ä‰∏ÄÊù°Âª∫ËÆÆ">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                      <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 0 1 0 1.06L9.06 10l3.73 3.71a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" />
                                    </svg>
                                  </button>
                                  <span class="text-xs w-16 text-center">Âª∫ËÆÆ {{ (post.activeAiSuggestionIndex ?? 0) + 1 }} / {{ post.aiSuggestions.length }}</span>
                                  <button (click)="changeSuggestion(post, 'next')" [class]="'p-1 rounded-full transition-colors ' + typeConfig.reactionButtonClasses" aria-label="‰∏ã‰∏ÄÊù°Âª∫ËÆÆ">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                      <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 0 1 0-1.06L10.94 10 7.21 6.29a.75.75 0 1 1 1.06-1.06l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd" />
                                    </svg>
                                  </button>
                                </div>
                              } @else {
                                <!-- Spacer to keep regenerate button on the right -->
                                <div></div>
                              }
                            
                              <!-- Regenerate Button -->
                              <button (click)="getAiAnalysisForPost(post)" [class]="'flex items-center gap-1.5 text-xs font-semibold px-3 py-1.5 rounded-full transition-colors ' + typeConfig.reactionButtonClasses">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                  <path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201-4.42 5.5 5.5 0 0 1 10.842 2.162.75.75 0 0 1-1.49-.174.25.25 0 0 0-.493-.062c-.22.65-.54 1.253-.942 1.795a.75.75 0 0 1-1.054.093Z" clip-rule="evenodd" />
                                  <path fill-rule="evenodd" d="M4.688 8.576a5.5 5.5 0 0 1 9.201 4.42 5.5 5.5 0 0 1-10.842-2.162.75.75 0 0 1 1.49.174.25.25 0 0 0 .493.062c.22-.65.54-1.253.942-1.795a.75.75 0 0 1 1.054-.093ZM10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z" clip-rule="evenodd" />
                                </svg>
                                <span>ÈáçÊñ∞ÁîüÊàê</span>
                              </button>
                          </div>

                        } @else {
                          <button (click)="getAiAnalysisForPost(post)" [class]="'w-full flex items-center justify-center gap-2 text-sm font-bold px-4 py-2 rounded-lg transition-colors ' + typeConfig.reactionButtonClasses">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                <path d="M9.53 2.47a.75.75 0 0 1 0 1.06L6.31 6.75h.94a4.25 4.25 0 0 1 2.911 7.125 3.375 3.375 0 0 1-2.33 5.442.75.75 0 0 1-.956-1.159 1.875 1.875 0 0 0 1.296-3.001 2.75 2.75 0 0 0-1.9-4.657h-.94l3.22 3.22a.75.75 0 1 1-1.06 1.06l-4.5-4.5a.75.75 0 0 1 0-1.06l4.5-4.5a.75.75 0 0 1 1.06 0Zm1.019 1.019a.75.75 0 0 0-1.06-1.06l-4.5 4.5a.75.75 0 0 0 0 1.06l4.5 4.5a.75.75 0 1 0 1.06-1.06L7.81 8.25h.94a2.75 2.75 0 0 1 1.9 4.657 1.875 1.875 0 0 1-1.296 3.001.75.75 0 0 0 .956 1.159 3.375 3.375 0 0 0 2.33-5.442A4.25 4.25 0 0 0 12.75 8.25h-.94l3.22-3.22a.75.75 0 0 0-1.06-1.06L10.55 6.19l-.001-.001Z"></path>
                                <path d="M16.5 6.75a.75.75 0 0 0 0-1.5h-2.5a.75.75 0 0 0 0 1.5h2.5Zm-5.5 8a.75.75 0 0 0 0 1.5h2.5a.75.75 0 0 0 0-1.5h-2.5Z"></path>
                            </svg>
                            <span>‚ú® AI ÂàÜÊûê</span>
                          </button>
                        }
                      </div>

                      <!-- Media Display -->
                      @if (post.media && post.media.length > 0) {
                        <div class="mt-3 grid gap-2" [class.grid-cols-2]="post.media.length > 1">
                            @for (item of post.media; track item.url) {
                                @if (item.type === 'image') {
                                    <img [ngSrc]="item.url" alt="Post media" width="400" height="250" class="rounded-lg object-cover w-full">
                                }
                                @if (item.type === 'video') {
                                    <video [src]="item.url" controls class="rounded-lg w-full bg-black"></video>
                                }
                            }
                        </div>
                      }

                      <!-- Timestamp -->
                      <div [class]="'text-center text-xs mt-3 ' + typeConfig.timestampClasses">
                        {{ post.timestamp }}
                      </div>
            
                      <!-- Task/Chore Section -->
                      @if (post.type === 'TASK' || post.type === 'CHORE' || post.type === 'APPOINTMENT') {
                        <div [class]="'mt-4 flex items-center justify-between gap-4 border-t pt-3 ' + typeConfig.separatorBorderClasses">
                          <div class="flex items-center">
                            @if (post.status) {
                              <span [class]="'text-xs font-semibold px-3 py-1 rounded-full ' + typeConfig.statusChipClasses(post.status)">
                                {{ getNeedStatusConfig(post.status).text }}
                              </span>
                            }
                            <div class="flex -space-x-2 ml-3">
                              @for(assignee of post.assignees; track assignee.name) {
                                <img [ngSrc]="assignee.avatar" [alt]="assignee.name" width="28" height="28" class="inline-block h-7 w-7 rounded-full ring-2" [class]="typeConfig.assigneeRingClasses" [title]="assignee.name">
                              }
                            </div>
                          </div>
                        </div>
                      }

                      <!-- Reactions Display -->
                      @if(post.reactions.length > 0) {
                          <div [class]="'mt-4 pt-3 border-t space-y-2 ' + typeConfig.separatorBorderClasses">
                              @for(reactionType of reactionTypes; track reactionType) {
                                  @let reactors = getReactionsByType(post, reactionType);
                                  @if(reactors.length > 0) {
                                      @let reactionConfig = getReactionConfig(reactionType);
                                      <div class="flex items-center gap-2 text-sm">
                                          <span [class]="'font-semibold ' + typeConfig.bodyTextClasses">{{ reactionConfig.label }}</span>
                                          <div class="flex -space-x-2">
                                              @for(user of reactors; track user.name) {
                                                  <img [ngSrc]="user.avatar" [alt]="user.name" width="24" height="24" class="inline-block h-6 w-6 rounded-full ring-2" [class]="typeConfig.assigneeRingClasses" [title]="user.name">
                                              }
                                          </div>
                                      </div>
                                  }
                              }
                          </div>
                      }
            
                      <!-- Bubble Footer (Reply) -->
                      <div [class]="'mt-3 border-t pt-2 flex justify-between items-center ' + typeConfig.separatorBorderClasses">
                        <div class="flex items-center gap-2">
                            <button (click)="addReaction(post.id, 'ILL_DO_IT')" [disabled]="hasReacted(post, 'ILL_DO_IT')" [class]="'text-xs font-semibold px-2.5 py-1.5 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed ' + typeConfig.reactionButtonClasses">ÊàëÊù•ÂÅö</button>
                            <button (click)="addReaction(post.id, 'ILL_JOIN')" [disabled]="hasReacted(post, 'ILL_JOIN')" [class]="'text-xs font-semibold px-2.5 py-1.5 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed ' + typeConfig.reactionButtonClasses">ÊàëÂèÇÂä†</button>
                            <button (click)="addReaction(post.id, 'GOT_IT')" [disabled]="hasReacted(post, 'GOT_IT')" [class]="'text-xs font-semibold px-2.5 py-1.5 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed ' + typeConfig.reactionButtonClasses">ÊàëÁü•ÈÅì‰∫Ü</button>

                            @if ((post.type === 'TASK' || post.type === 'CHORE' || post.type === 'APPOINTMENT') && post.status !== 'DONE' && isUserInvolved(post)) {
                              <button (click)="markAsDone(post.id)" class="text-xs font-semibold px-2.5 py-1.5 rounded-full transition-colors bg-emerald-500/20 text-emerald-100 hover:bg-emerald-500/40 flex items-center gap-1">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4">
                                  <path fill-rule="evenodd" d="M12.416 3.376a.75.75 0 0 1 .208 1.04l-5 7.5a.75.75 0 0 1-1.154.114l-3-3a.75.75 0 0 1 1.06-1.06l2.35 2.35 4.493-6.74a.75.75 0 0 1 1.04-.208Z" clip-rule="evenodd" />
                                </svg>
                                <span>ÂÆåÊàê</span>
                              </button>
                            }
                        </div>

                        <button (click)="toggleCommentInput(post.id)" [class]="'transition-colors p-1 rounded-full ' + (post.type === 'DISCOVERY' || post.type === 'TASK' || post.type === 'CHORE' || post.type === 'APPOINTMENT' || post.type === 'MEAL_SUGGESTION' ? ' text-white/70 hover:text-white hover:bg-white/20' : ' text-slate-400 hover:text-slate-600 hover:bg-slate-100')" aria-label="ÂõûÂ§ç">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                              <path fill-rule="evenodd" d="M7.793 2.232a.75.75 0 0 1-.025 1.06L3.622 7.25h6.128a5.25 5.25 0 0 1 0 10.5H8.75a.75.75 0 0 1 0-1.5h1.001a3.75 3.75 0 1 0 0-7.5H3.622l4.146 3.957a.75.75 0 0 1-1.036 1.085l-5.5-5.25a.75.75 0 0 1 0-1.085l5.5-5.25a.75.75 0 0 1 1.06.025Z" clip-rule="evenodd" />
                            </svg>
                          </button>
                      </div>
            
                    </div>
                  </div>
                </div>
                
                <!-- Comments Section -->
                @if (post.comments.length > 0) {
                  <div [class]="'mt-2 space-y-2 w-full max-w-md' + (isMyPost ? ' self-end pr-12' : ' self-start pl-12')">
                    @for(comment of post.comments; track comment.id) {
                      <div class="flex items-start gap-2.5 text-sm w-full">
                        @if (comment.author !== loggedInUser()!.name) {
                          <img [ngSrc]="comment.authorAvatar" [alt]="comment.author" width="28" height="28" class="h-7 w-7 rounded-full object-cover flex-shrink-0">
                        }
                        <div [class]="'flex-1 rounded-lg px-3 py-2' + (comment.author === loggedInUser()!.name ? ' bg-sky-100' : ' bg-slate-100')">
                          <p class="font-semibold text-slate-800">{{comment.author}}</p>
                          <p class="text-slate-600">{{comment.content}}</p>
                        </div>
                        @if (comment.author === loggedInUser()!.name) {
                          <img [ngSrc]="comment.authorAvatar" [alt]="comment.author" width="28" height="28" class="h-7 w-7 rounded-full object-cover flex-shrink-0">
                        }
                      </div>
                    }
                  </div>
                }
                
                <!-- New Comment Input -->
                @if (commentingOnPostId() === post.id) {
                  <div [class]="'mt-2 w-full max-w-md animate-fade-in-down' + (isMyPost ? ' self-end pr-12' : ' self-start pl-12')">
                    <div class="flex items-start gap-2.5 text-sm w-full">
                      <img [ngSrc]="loggedInUser()!.avatar" [alt]="loggedInUser()!.name" width="28" height="28" class="h-7 w-7 rounded-full object-cover flex-shrink-0">
                      <div class="flex-1 space-y-2">
                        <textarea [value]="newCommentContent()" (input)="onCommentInput($event)" rows="2" class="w-full text-sm block px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-sky-500 focus:border-sky-500" placeholder="Ê∑ªÂä†‰Ω†ÁöÑÊÉ≥Ê≥ï..."></textarea>
                        <div class="flex justify-end gap-2">
                          <button (click)="toggleCommentInput(post.id)" class="px-3 py-1 rounded-md text-xs text-slate-600 font-semibold hover:bg-slate-100">ÂèñÊ∂à</button>
                          <button (click)="submitComment(post.id)" [disabled]="!newCommentContent()" class="px-3 py-1 rounded-md text-xs text-white font-semibold bg-sky-500 hover:bg-sky-600 disabled:bg-slate-300">ÂèëÈÄÅ</button>
                        </div>
                      </div>
                    </div>
                  </div>
                }
              </div>
            }
          } @else {
            @if (urgentHealthPosts().length === 0) {
              <div class="text-center py-16">
                <p class="text-5xl mb-2">üí®</p>
                <p class="text-slate-500 font-medium">ËøôÈáå‰ªÄ‰πàÈÉΩÊ≤°Êúâ„ÄÇ</p>
              </div>
            }
          }
          <footer class="text-center pt-4">
              <p class="text-sm text-slate-400">&copy; {{ currentYear }} ÂÆ∂‰∫ã ÂÆ∂Â∫≠Â∫îÁî®</p>
          </footer>
        </main>
      }

      @if (activeTab() === 'health') {
        <main class="mt-6">
          <h2 class="text-2xl font-bold text-slate-800 text-center mb-2">ÂÅ•Â∫∑Êó•Âøó</h2>
          <p class="text-slate-500 text-center mb-6">ËÆ∞ÂΩï‰Ω†ÁöÑË∫´ÂøÉÁä∂ÊÄÅÔºåÊõ¥Â•ΩÂú∞ÂÖ≥Áà±Ëá™Â∑±„ÄÇ</p>
      
          <!-- New Unified Log Section -->
          <section class="mb-8">
            <form [formGroup]="newHealthLogForm" (ngSubmit)="onAddNewHealthLogSubmit()">
              <div class="p-4 bg-white rounded-xl border border-slate-200 shadow-sm">
                <label for="healthLogContent" class="block text-base font-bold text-slate-700 mb-2 text-center">Áé∞Âú®ÊÑüËßâÊÄé‰πàÊ†∑Ôºü</label>
                <textarea
                  id="healthLogContent"
                  formControlName="content"
                  class="w-full bg-slate-100 border-slate-300 rounded-md focus:ring-sky-500 focus:border-sky-500 text-slate-800 placeholder-slate-400"
                  rows="3"
                  placeholder="ËÆ∞ÂΩï‰Ω†ÁöÑË∫´ÂøÉÁä∂ÊÄÅ..."></textarea>
                
                <div class="mt-3 grid grid-cols-3 sm:grid-cols-4 gap-2">
                  @for (option of quickLogOptions; track option.label) {
                    <button type="button" (click)="selectQuickLog(option)" class="flex items-center justify-center gap-2 p-2 bg-slate-100 hover:bg-sky-100 text-slate-700 hover:text-sky-800 rounded-lg transition-colors text-sm font-medium">
                      <span class="text-xl">{{ option.emoji }}</span>
                      <span>{{ option.label }}</span>
                    </button>
                  }
                </div>
          
                <button type="submit" [disabled]="newHealthLogForm.invalid" class="mt-4 w-full flex items-center justify-center gap-2 text-sm font-bold bg-sky-500 text-white py-2.5 rounded-lg hover:bg-sky-600 transition-colors disabled:bg-slate-300 disabled:cursor-not-allowed">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                    <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                  </svg>
                  <span>‰øùÂ≠òËÆ∞ÂΩï</span>
                </button>
              </div>
            </form>
          </section>
      
          <!-- Log History -->
          <section>
            <h3 class="text-base font-bold text-slate-600 mb-3">ÂéÜÂè≤ËÆ∞ÂΩï</h3>
            @if (userHealthLogs().length > 0) {
              <div class="space-y-3">
                @for (log of userHealthLogs(); track log.id) {
                  <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-3 flex items-center gap-4 animate-fade-in-down">
                    <span class="text-2xl h-10 w-10 flex items-center justify-center bg-slate-100 rounded-full">
                      @switch (log.mood) {
                        @case ('‰∏çÈîô') { <span class="text-xl">üòä</span> }
                        @case ('ÂÖÖÊ≤õ') { <span class="text-xl">‚ö°Ô∏è</span> }
                        @case ('Áñ≤ÊÉ´') { <span class="text-xl">ü•±</span> }
                        @case ('ÂéãÂäõÂ§ß') { <span class="text-xl">ü§Ø</span> }
                        @default { <span class="text-xl">üìù</span> }
                      }
                    </span>
                    <div class="flex-1">
                      <p class="font-medium text-slate-800">{{ log.content }}</p>
                      <p class="text-xs text-slate-400 mt-1">{{ log.timestamp }}</p>
                    </div>
                  </div>
                }
              </div>
            } @else {
              <div class="text-center py-10">
                <p class="text-4xl mb-2">üåø</p>
                <p class="text-slate-500 font-medium">ËøòÊ≤°Êúâ‰ªª‰ΩïÂÅ•Â∫∑ËÆ∞ÂΩï„ÄÇ</p>
                <p class="text-sm text-slate-400 mt-1">‰ªé‰∏äÈù¢ÁöÑÂø´ÈÄüËÆ∞ÂΩïÂºÄÂßãÂêßÔºÅ</p>
              </div>
            }
          </section>
      
          <footer class="text-center mt-12 py-4">
            <p class="text-sm text-slate-400">&copy; {{ currentYear }} ÂÆ∂‰∫ã ÂÆ∂Â∫≠Â∫îÁî®</p>
          </footer>
        </main>
      }

      @if (activeTab() === 'inventory') {
        <main class="mt-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-slate-800">ÂÆ∂Â∫≠Áâ©ËµÑÊ∏ÖÂçï</h2>
            <button (click)="openNewItemPanel()" class="bg-sky-500 text-white rounded-full w-10 h-10 flex items-center justify-center hover:bg-sky-600 transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-sky-300 shadow">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>
            </button>
          </div>

          <div class="mb-6 p-1 bg-slate-200/80 rounded-lg flex gap-1 text-sm font-bold">
            <button (click)="activeInventoryTab.set('stock')" [class]="activeInventoryTab() === 'stock' ? 'bg-white shadow-sm text-slate-700' : 'text-slate-500 hover:text-slate-700'" class="py-2 px-3 rounded-md transition-all flex-1 text-center">
              Â∫ìÂ≠òÊ∏ÖÂçï
            </button>
            <button (click)="activeInventoryTab.set('shopping')" [class]="activeInventoryTab() === 'shopping' ? 'bg-white shadow-sm text-slate-700' : 'text-slate-500 hover:text-slate-700'" class="py-2 px-3 rounded-md transition-all flex-1 text-center relative">
              Ë¥≠Áâ©Ê∏ÖÂçï
              @if (shoppingListItems().length > 0) {
                <span class="absolute top-0 right-0 -mt-1 -mr-1 flex h-5 w-5 items-center justify-center rounded-full bg-rose-500 text-white text-xs font-bold ring-2 ring-slate-50">
                  {{ shoppingListItems().length }}
                </span>
              }
            </button>
          </div>
          
          @if (activeInventoryTab() === 'stock') {
            <section class="space-y-8">
              @if ((groupedInventory() | keyvalue).length > 0) {
                @for (category of (groupedInventory() | keyvalue); track category.key) {
                  <div>
                    <h3 class="text-base font-bold text-slate-600 mb-3 flex items-center gap-2">
                        <span>{{ category.key }}</span>
                    </h3>
                    <div class="space-y-3">
                      @for (item of category.value; track item.id) {
                        @let statusConfig = getInventoryStatusConfig(item.status);
                        <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-3 flex items-start gap-4">
                          <img [ngSrc]="item.image" [alt]="item.name" width="80" height="80" class="w-20 h-20 rounded-md object-cover border border-slate-100">
                          <div class="flex-1">
                              <div class="flex justify-between items-start">
                                  <h4 class="font-bold text-slate-800">{{ item.name }}</h4>
                                  <span class="text-xs font-semibold px-2 py-0.5 rounded-full" [class]="statusConfig.buttonClasses">{{ statusConfig.text }}</span>
                              </div>
                              @if (item.brand || item.store) {
                                <p class="text-sm text-slate-500">
                                    {{ item.brand }}
                                    @if (item.brand && item.store) {
                                      <span class="mx-1">‚Ä¢</span>
                                    }
                                    {{ item.store }}
                                </p>
                              }
                              @if (item.notes) {
                                <p class="text-xs text-slate-400 mt-1 italic">"{{ item.notes }}"</p>
                              }
                              <div class="mt-3 flex flex-wrap gap-2">
                                  <button (click)="updateItemStatus(item.id, 'IN_STOCK')" [disabled]="item.status === 'IN_STOCK'" class="text-xs font-semibold px-2.5 py-1 rounded-full transition-colors bg-slate-100 hover:bg-slate-200 text-slate-700 disabled:bg-emerald-100 disabled:text-emerald-800 disabled:opacity-100 disabled:cursor-default">
                                      ÊúâË¥ß
                                  </button>
                                  <button (click)="updateItemStatus(item.id, 'RUNNING_LOW')" [disabled]="item.status === 'RUNNING_LOW'" class="text-xs font-semibold px-2.5 py-1 rounded-full transition-colors bg-slate-100 hover:bg-slate-200 text-slate-700 disabled:bg-amber-100 disabled:text-amber-800 disabled:opacity-100 disabled:cursor-default">
                                      Âø´Áî®ÂÆå‰∫Ü
                                  </button>
                                  <button (click)="updateItemStatus(item.id, 'OUT_OF_STOCK')" [disabled]="item.status === 'OUT_OF_STOCK'" class="text-xs font-semibold px-2.5 py-1 rounded-full transition-colors bg-slate-100 hover:bg-slate-200 text-slate-700 disabled:bg-rose-100 disabled:text-rose-800 disabled:opacity-100 disabled:cursor-default">
                                      Â∑≤Áî®ÂÆå
                                  </button>
                              </div>
                          </div>
                        </div>
                      }
                    </div>
                  </div>
                }
              } @else {
                <div class="text-center py-16">
                  <p class="text-5xl mb-2">üì¶</p>
                  <p class="text-slate-500 font-medium">Â∫ìÂ≠òÊòØÁ©∫ÁöÑ„ÄÇ</p>
                  <p class="text-sm text-slate-400 mt-2">ÁÇπÂáªÂè≥‰∏äËßíÁöÑ '+' Ê∑ªÂä†Á¨¨‰∏Ä‰ª∂Áâ©ÂìÅÔºÅ</p>
                </div>
              }
            </section>
          } @else {
            <section class="space-y-3">
              @if (shoppingListItems().length > 0) {
                @for (item of shoppingListItems(); track item.id) {
                  @let statusConfig = getInventoryStatusConfig(item.status);
                  <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-3 flex items-start gap-4">
                    <img [ngSrc]="item.image" [alt]="item.name" width="80" height="80" class="w-20 h-20 rounded-md object-cover border border-slate-100">
                    <div class="flex-1">
                      <div class="flex justify-between items-start">
                          <h4 class="font-bold text-slate-800">{{ item.name }}</h4>
                          <span class="text-xs font-semibold px-2 py-0.5 rounded-full" [class]="statusConfig.buttonClasses">{{ statusConfig.text }}</span>
                      </div>
                      @if (item.brand || item.store) {
                        <p class="text-sm text-slate-500">
                            {{ item.brand }}
                            @if (item.brand && item.store) { <span class="mx-1">‚Ä¢</span> }
                            {{ item.store }}
                        </p>
                      }
                      <div class="mt-3 flex justify-end">
                        <button (click)="markAsPurchased(item.id)" class="flex items-center gap-1.5 text-xs font-semibold bg-emerald-100 hover:bg-emerald-200 text-emerald-800 px-3 py-1.5 rounded-full transition-colors">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4">
                            <path fill-rule="evenodd" d="M12.416 3.376a.75.75 0 0 1 .208 1.04l-5 7.5a.75.75 0 0 1-1.154.114l-3-3a.75.75 0 0 1 1.06-1.06l2.35 2.35 4.493-6.74a.75.75 0 0 1 1.04-.208Z" clip-rule="evenodd" />
                          </svg>
                          <span>Â∑≤Ë¥≠</span>
                        </button>
                      </div>
                    </div>
                  </div>
                }
              } @else {
                <div class="text-center py-16">
                  <p class="text-5xl mb-2">üõí</p>
                  <p class="text-slate-500 font-medium">Ë¥≠Áâ©Ê∏ÖÂçïÊòØÁ©∫ÁöÑÔºÅ</p>
                  <p class="text-sm text-slate-400 mt-2">ÂΩìÂ∫ìÂ≠òÁâ©ÂìÅÂø´Áî®ÂÆåÊó∂ÔºåÂÆÉ‰ª¨‰ºöÂá∫Áé∞Âú®ËøôÈáå„ÄÇ</p>
                </div>
              }
            </section>
          }
           <footer class="text-center mt-12 py-4">
              <p class="text-sm text-slate-400">&copy; {{ currentYear }} ÂÆ∂‰∫ã ÂÆ∂Â∫≠Â∫îÁî®</p>
          </footer>
        </main>
      }
      
      @if (activeTab() === 'profile') {
        <main class="mt-6">
          <h2 class="text-2xl font-bold text-slate-800 mb-6 text-center">ÊàëÁöÑ</h2>
           <div class="flex flex-col items-center gap-4">
                <img priority [ngSrc]="loggedInUser()!.avatar" [alt]="loggedInUser()!.name" width="96" height="96" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg">
                <div class="text-center">
                    <h3 class="text-xl font-bold text-slate-800">{{ loggedInUser()!.name }}</h3>
                    <p class="text-sm text-slate-500">Âπ¥ÈæÑ: {{ loggedInUser()!.age }}</p>
                </div>
                <button (click)="logout()" class="mt-4 w-full max-w-xs flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-rose-600 hover:bg-rose-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-rose-500">
                  ÁôªÂá∫
                </button>
            </div>
           <footer class="text-center mt-12 py-4">
              <p class="text-sm text-slate-400">&copy; {{ currentYear }} ÂÆ∂‰∫ã ÂÆ∂Â∫≠Â∫îÁî®</p>
          </footer>
        </main>
      }

    </div>
    
    <!-- Backdrop for overlays -->
    @if (isFabMenuOpen() || isNewPostPanelOpen() || isNewItemPanelOpen()) {
      <div (click)="isFabMenuOpen() ? toggleFabMenu() : (isNewPostPanelOpen() ? closeNewPostPanel() : closeNewItemPanel() )" class="fixed inset-0 bg-black/40 z-30 animate-fade-in"></div>
    }

    <!-- New Post Panel -->
    @if (isNewPostPanelOpen()) {
      <div class="fixed bottom-0 left-0 right-0 max-w-2xl mx-auto p-4 z-40 animate-slide-in-up">
        <div class="bg-white rounded-xl shadow-2xl p-4">
          <h3 class="font-bold text-lg text-slate-800 text-center mb-3">ÂÜôÁÇπ‰∏úË•ø</h3>
          <textarea 
            [value]="newPostContent()" 
            (input)="onNewPostInput($event)"
            class="w-full bg-slate-100 border-slate-300 rounded-md focus:ring-sky-500 focus:border-sky-500 text-slate-800 placeholder-slate-400" 
            rows="4" 
            placeholder="ÂàÜ‰∫´ÂÆ∂Â∫≠ÁöÑÊñ∞È≤ú‰∫ã..."></textarea>
          <div class="mt-3">
              <p class="text-xs font-semibold text-slate-500 mb-2">ÈÄâÊã©ÂàÜÁ±ª</p>
              <div class="flex flex-wrap gap-2 text-sm font-bold">
                <button (click)="newPostCategory.set('daily')" [class]="newPostCategory() === 'daily' ? 'bg-sky-500 text-white' : 'bg-slate-200 text-slate-600 hover:bg-slate-300'" class="px-3 py-1 rounded-full transition-colors">üìù ÂÆ∂Â∫≠Êó•Â∏∏</button>
                <button (click)="newPostCategory.set('health')" [class]="newPostCategory() === 'health' ? 'bg-rose-500 text-white' : 'bg-slate-200 text-slate-600 hover:bg-slate-300'" class="px-3 py-1 rounded-full transition-colors">üè• ÂÆ∂Â∫≠ÂÅ•Â∫∑</button>
                <button (click)="newPostCategory.set('knowledge')" [class]="newPostCategory() === 'knowledge' ? 'bg-purple-500 text-white' : 'bg-slate-200 text-slate-600 hover:bg-slate-300'" class="px-3 py-1 rounded-full transition-colors">üí° Áü•ËØÜÂàÜ‰∫´</button>
              </div>
          </div>
          <div class="mt-4 flex justify-end gap-3">
            <button (click)="closeNewPostPanel()" class="px-4 py-2 rounded-lg text-slate-600 font-semibold hover:bg-slate-100">ÂèñÊ∂à</button>
            <button (click)="publishNewPost()" [disabled]="!newPostContent()" class="px-6 py-2 rounded-lg bg-sky-500 text-white font-semibold hover:bg-sky-600 transition-colors disabled:bg-slate-300 disabled:cursor-not-allowed">ÂèëÂ∏É</button>
          </div>
        </div>
      </div>
    }

    <!-- New Item Panel -->
    @if (isNewItemPanelOpen()) {
      <div class="fixed bottom-0 left-0 right-0 max-w-2xl mx-auto p-4 z-40 animate-slide-in-up">
        <form [formGroup]="newItemForm" (ngSubmit)="onAddNewItemSubmit()" class="bg-white rounded-xl shadow-2xl p-4 space-y-4">
          <h3 class="font-bold text-lg text-slate-800 text-center">Ê∑ªÂä†Êñ∞Áâ©ËµÑ</h3>
          
          <div>
            <label for="itemName" class="block text-xs font-medium text-slate-600 mb-1">ÂêçÁß∞*</label>
            <input id="itemName" type="text" formControlName="name" class="w-full text-sm block px-3 py-2 bg-slate-100 border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-sky-500 focus:border-sky-500" placeholder="‰æãÂ¶ÇÔºöÊúâÊú∫ÂÖ®ËÑÇÁâõÂ•∂" required>
          </div>
          
          <div>
            <label for="itemCategory" class="block text-xs font-medium text-slate-600 mb-1">ÂàÜÁ±ª*</label>
            <select id="itemCategory" formControlName="category" class="w-full text-sm block px-3 py-2 bg-slate-100 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500">
              <option value="È£üÊùê">È£üÊùê</option>
              <option value="Ê∏ÖÊ¥ÅÁî®ÂìÅ">Ê∏ÖÊ¥ÅÁî®ÂìÅ</option>
              <option value="ÁîüÊ¥ªÁî®ÂìÅ">ÁîüÊ¥ªÁî®ÂìÅ</option>
            </select>
          </div>

          <div>
            <label for="itemImage" class="block text-xs font-medium text-slate-600 mb-1">ÂõæÁâáÈìæÊé• (ÂèØÈÄâ)</label>
            <input id="itemImage" type="text" formControlName="image" class="w-full text-sm block px-3 py-2 bg-slate-100 border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-sky-500 focus:border-sky-500">
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="itemBrand" class="block text-xs font-medium text-slate-600 mb-1">ÂìÅÁâå (ÂèØÈÄâ)</label>
              <input id="itemBrand" type="text" formControlName="brand" class="w-full text-sm block px-3 py-2 bg-slate-100 border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-sky-500 focus:border-sky-500">
            </div>
            <div>
              <label for="itemStore" class="block text-xs font-medium text-slate-600 mb-1">ÂïÜÂ∫ó (ÂèØÈÄâ)</label>
              <input id="itemStore" type="text" formControlName="store" class="w-full text-sm block px-3 py-2 bg-slate-100 border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-sky-500 focus:border-sky-500">
            </div>
          </div>

          <div>
            <label for="itemNotes" class="block text-xs font-medium text-slate-600 mb-1">Â§áÊ≥® (ÂèØÈÄâ)</label>
            <textarea id="itemNotes" formControlName="notes" rows="2" class="w-full text-sm block px-3 py-2 bg-slate-100 border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-sky-500 focus:border-sky-500"></textarea>
          </div>

          <div class="mt-4 flex justify-end gap-3">
            <button type="button" (click)="closeNewItemPanel()" class="px-4 py-2 rounded-lg text-slate-600 font-semibold hover:bg-slate-100">ÂèñÊ∂à</button>
            <button type="submit" [disabled]="newItemForm.invalid" class="px-6 py-2 rounded-lg bg-sky-500 text-white font-semibold hover:bg-sky-600 transition-colors disabled:bg-slate-300 disabled:cursor-not-allowed">‰øùÂ≠ò</button>
          </div>
        </form>
      </div>
    }

    <!-- Fixed Bottom Navigation -->
    <footer class="fixed bottom-0 left-0 right-0 z-30">
        <div class="max-w-2xl mx-auto h-16 relative">
            <div class="absolute left-1/2 top-0 -translate-x-1/2 -translate-y-1/2 z-50">
                <button (click)="toggleFabMenu()" aria-label="ÂàõÂª∫Êñ∞Â∏ñÂ≠ê" class="bg-sky-500 text-white rounded-full w-16 h-16 flex items-center justify-center hover:bg-sky-600 transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-sky-300 shadow-lg">
                    @if(isFabMenuOpen()) {
                    <svg class="w-7 h-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                    } @else {
                    <svg class="w-7 h-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    }
                </button>
            </div>
            <nav class="bg-white/80 backdrop-blur-sm border-t border-slate-200 h-full grid grid-cols-4 items-center px-4">
                <!-- Home Tab -->
                <button (click)="setActiveTab('home')" class="flex flex-col items-center justify-center gap-1 transition-colors" [class.text-sky-500]="activeTab() === 'home'" [class.text-slate-500]="activeTab() !== 'home'">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                    <path fill-rule="evenodd" d="M9.293 2.293a1 1 0 0 1 1.414 0l7 7A1 1 0 0 1 17 11h-1v6a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-6H3a1 1 0 0 1-.707-1.707l7-7Z" clip-rule="evenodd" />
                </svg>
                <span class="text-xs font-bold">È¶ñÈ°µ</span>
                </button>

                <!-- Inventory Tab -->
                <button (click)="setActiveTab('inventory')" class="flex flex-col items-center justify-center gap-1 transition-colors" [class.text-sky-500]="activeTab() === 'inventory'" [class.text-slate-500]="activeTab() !== 'inventory'">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                    <path d="M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z" />
                    <path fill-rule="evenodd" d="M4 2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H4Zm12 2H4v12h12V4Z" clip-rule="evenodd" />
                </svg>
                <span class="text-xs font-bold">Áâ©ËµÑ</span>
                </button>
        
                <!-- Health Tab -->
                <button (click)="setActiveTab('health')" class="flex flex-col items-center justify-center gap-1 transition-colors" [class.text-sky-500]="activeTab() === 'health'" [class.text-slate-500]="activeTab() !== 'health'">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                    <path d="m9.653 16.915-.005-.003-.019-.01a20.759 20.759 0 0 1-1.162-.682 22.045 22.045 0 0 1-2.582-1.9-22.045 22.045 0 0 1-2.582-1.901 20.759 20.759 0 0 1-1.162-.682l-.019-.01-.005-.003h-.002a.739.739 0 0 1-.69-1.06l.496-1.983a.75.75 0 0 1 .98-.497l1.555.39a.75.75 0 0 1 .497-.98l-1.983-.496a.739.739 0 0 1-1.06-.69zM12.79 3.23a.75.75 0 0 1 1.06 0l.69.69a.75.75 0 0 1 0 1.06l-.69.69a.75.75 0 0 1-1.06 0l-.69-.69a.75.75 0 0 1 0-1.06l.69-.69z" />
                    <path d="M12.25 10.25a.75.75 0 0 1 1.5 0v5.5a.75.75 0 0 1-1.5 0v-5.5z" />
                    <path d="M10.25 12.25a.75.75 0 0 0 0-1.5h-5.5a.75.75 0 0 0 0 1.5h5.5z" />
                    <path d="m9.653 16.915.002.001a.75.75 0 0 1 .69 1.06l-.496 1.983a.75.75 0 0 1-.98.497l-1.555-.39a.75.75 0 0 1-.497.98l1.983.496a.75.75 0 0 1 1.06.69z" />
                  </svg>
                  <span class="text-xs font-bold">ÂÅ•Â∫∑</span>
                </button>

                 <!-- Profile Tab -->
                <button (click)="setActiveTab('profile')" class="flex flex-col items-center justify-center gap-1 transition-colors" [class.text-sky-500]="activeTab() === 'profile'" [class.text-slate-500]="activeTab() !== 'profile'">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-5.5-2.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0ZM10 12a5.99 5.99 0 0 0-4.793 2.39A6.483 6.483 0 0 0 10 16.5a6.483 6.483 0 0 0 4.793-2.11A5.99 5.99 0 0 0 10 12Z" clip-rule="evenodd" />
                    </svg>
                  <span class="text-xs font-bold">ÊàëÁöÑ</span>
                </button>
            </nav>
        </div>
    </footer>


    <!-- FAB Menu Popup -->
    @if(isFabMenuOpen()) {
      <div class="fixed bottom-24 left-1/2 -translate-x-1/2 flex flex-col-reverse items-center gap-3 animate-fade-in-down z-40">
          <button (click)="openNewPostPanel()" class="w-36 justify-center whitespace-nowrap flex items-center gap-2 bg-white text-slate-700 px-4 py-2 rounded-full shadow-lg font-semibold transform transition-all hover:scale-105 active:scale-95">
              <span class="text-xl">üìù</span>
              <span>ÂÜôÁÇπ‰∏úË•ø</span>
          </button>
          <button (click)="quickSend('meal_suggestion')" class="w-36 justify-center whitespace-nowrap flex items-center gap-2 bg-white text-amber-700 px-4 py-2 rounded-full shadow-lg font-semibold transform transition-all hover:scale-105 active:scale-95">
              <span class="text-xl">ü§î</span>
              <span>ÊÉ≥ÂêÉ‰ªÄ‰πà?</span>
          </button>
          <button (click)="quickSend('meeting')" class="w-36 justify-center whitespace-nowrap flex items-center gap-2 bg-white text-green-700 px-4 py-2 rounded-full shadow-lg font-semibold transform transition-all hover:scale-105 active:scale-95">
              <span class="text-xl">üìÖ</span>
              <span>ÂºÄ‰∏™‰ºö</span>
          </button>
          <button (click)="quickSend('help')" class="w-36 justify-center whitespace-nowrap flex items-center gap-2 bg-white text-sky-700 px-4 py-2 rounded-full shadow-lg font-semibold transform transition-all hover:scale-105 active:scale-95">
              <span class="text-xl">üôã</span>
              <span>Ê±ÇÂ∏ÆÂä©</span>
          </button>
          <button (click)="quickSend('care')" class="w-36 justify-center whitespace-nowrap flex items-center gap-2 bg-white text-rose-700 px-4 py-2 rounded-full shadow-lg font-semibold transform transition-all hover:scale-105 active:scale-95">
              <span class="text-xl">ü§í</span>
              <span>Ê±ÇÂÖ≥ÂøÉ</span>
          </button>
      </div>
    }
  }
</div>